<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CheckMyWeight â€” Kalkulator BMI & Artikel Kesehatan</title>
  <meta name="description" content="Website sederhana untuk menghitung BMI, estimasi berat ideal, artikel kesehatan, dan avatar gamifikasi." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for avatar transitions */
    .avatar-box { width:160px; height:160px; display:flex; align-items:center; justify-content:center; border-radius:12px; }
    .pulse { animation: pulse 1.6s infinite; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    /* Simple card shadows */
    .soft-card { box-shadow: 0 6px 18px rgba(16,24,40,0.06), 0 1px 2px rgba(16,24,40,0.04); }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-white min-h-screen text-slate-800">
  <div class="max-w-6xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 bg-gradient-to-tr from-violet-500 to-fuchsia-500 text-white rounded-xl flex items-center justify-center text-2xl font-bold">CW</div>
        <div>
          <h1 class="text-2xl font-extrabold">CheckMyWeight</h1>
          <p class="text-sm text-slate-500">Kalkulator BMI, Estimasi Ideal & Artikel kesehatan ringkas</p>
        </div>
      </div>
      <nav class="flex gap-3 items-center">
        <button id="btn-calc" ></button>
        <a href="{% url 'artikel' %}" class="px-4 py-2 rounded-lg bg-white soft-card hover:shadow-md">Artikel</a>
      </nav>
    </header>

    <main class="grid grid-cols-1 gap-6">
      <!-- Left column: Calculator -->
       
      <section id="panel-calc" class="bg-white p-6 rounded-2xl soft-card">
        <div class="flex items-start gap-6">
          <div class="flex-1">
            <h2 class="text-xl font-bold mb-2">Kalkulator BMI & Estimasi Berat Ideal</h2>
            <p class="text-sm text-slate-500 mb-4">Masukkan tinggi, berat, umur dan gender untuk melihat hasil BMI, estimasi berat ideal yang realistis, dan saran singkat.</p>

            <form id="bmi-form" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="text-sm font-medium">Berat (kg)</label>
                <input id="weight" type="number" min="10" step="0.1" class="mt-1 w-full rounded-lg border px-3 py-2" placeholder="mis. 70" required>
              </div>
              <div>
                <label class="text-sm font-medium">Tinggi (cm)</label>
                <input id="height" type="number" min="80" step="0.1" class="mt-1 w-full rounded-lg border px-3 py-2" placeholder="mis. 170" required>
              </div>
              <div>
                <label class="text-sm font-medium">Umur (tahun)</label>
                <input id="age" type="number" min="5" max="120" class="mt-1 w-full rounded-lg border px-3 py-2" placeholder="mis. 30" required>
              </div>
              <div>
                <label class="text-sm font-medium">Gender</label>
                <select id="gender" class="mt-1 w-full rounded-lg border px-3 py-2">
                  <option value="male">Laki-laki</option>
                  <option value="female">Perempuan</option>
                  <option value="other">Lainnya / Prefer not to say</option>
                </select>
              </div>

              <div class="sm:col-span-2 flex gap-3 mt-2">
                <button type="submit" class="px-4 py-2 rounded-lg bg-gradient-to-r from-emerald-400 to-green-500 text-white font-semibold">Hitung BMI</button>
                <button id="btn-reset" type="button" class="px-4 py-2 rounded-lg bg-white border">Reset</button>
                <button id="btn-share" type="button" class="ml-auto px-4 py-2 rounded-lg bg-indigo-600 text-white hidden">Bagikan</button>
              </div>
            </form>

            <div id="result-card" class="mt-5 p-4 rounded-lg bg-gradient-to-r from-white to-slate-50 border hidden">
              <div class="flex gap-4 items-center">
                <div class="avatar-box bg-slate-100" id="avatar-box">ðŸ™‚</div>
                <div>
                  <div class="text-sm text-slate-500">BMI</div>
                  <div id="bmi-value" class="text-2xl font-extrabold">--</div>
                  <div id="bmi-category" class="text-sm text-slate-600">--</div>
                </div>
              </div>

              <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="p-3 rounded-lg bg-white soft-card">
                  <div class="text-xs text-slate-500">Estimasi Berat Ideal</div>
                  <div id="ideal-weight" class="text-lg font-bold">-- kg</div>
                  <div id="ideal-note" class="text-xs text-slate-500 mt-1">Berdasarkan metode standar.</div>
                </div>
                <div class="p-3 rounded-lg bg-white soft-card">
                  <div class="text-xs text-slate-500">Estimasi Waktu Sehat</div>
                  <div id="time-estimate" class="text-lg font-bold">-- minggu</div>
                  <div id="time-note" class="text-xs text-slate-500 mt-1">Estimasi realistis penurunan 0.25-0.5 kg/minggu.</div>
                </div>
              </div>

              <div class="mt-4 text-sm text-slate-600" id="advice-area">
                <!-- Short advice inserted here -->
              </div>
            </div>

          </div>

          <!-- Right column: avatar + quick tips -->
          <aside class="w-44 hidden md:block">
            <div class="p-4 rounded-xl bg-gradient-to-b from-white to-slate-50 soft-card text-center">
              <div class="mx-auto avatar-box bg-gradient-to-tr from-violet-400 to-fuchsia-400 text-white text-4xl font-bold mb-3" id="side-avatar">ðŸ™‚</div>
              <div class="text-sm font-semibold" id="side-status">--</div>
              <p class="text-xs text-slate-500 mt-2">Avatar menunjukkan status BMI kamu â€” visual cepat untuk memahami hasil.</p>
            </div>

            <div class="mt-4 p-3 rounded-lg bg-white soft-card">
              <div class="text-sm font-semibold">Quick Tips</div>
              <ul class="text-xs mt-2 text-slate-600 space-y-1">
                <li>â€¢ Jaga defisit kalori moderat</li>
                <li>â€¢ Aktif bergerak 30 menit/hari</li>
                <li>â€¢ Tidur cukup & hidrasi</li>
              </ul>
            </div>
          </aside>
        </div>
      </section>

      <!-- Right column: Articles -->
      <!-- <section id="panel-articles" class="bg-white p-6 rounded-2xl soft-card">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-bold">Artikel Kesehatan</h3>
          <div class="flex gap-2">
            <select id="article-category" class="rounded-lg border px-3 py-2 text-sm">
              <option value="all">Semua Kategori</option>
            </select>
            <button id="btn-new-article" class="px-3 py-2 rounded-lg bg-indigo-600 text-white text-sm">Add Demo</button>
          </div>
        </div> -->

        <!-- <div id="article-list" class="grid grid-cols-1 gap-3"> -->
          <!-- articles loaded here -->
        <!-- </div> -->
      </section>
    </main>

    <footer class="mt-8 text-center text-sm text-slate-500">Â© 2025 CheckMyWeight â€” Prototype. Data hanya untuk edukasi.</footer>
  </div>

  <!-- Article Modal -->
  <div id="modal" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4">
    <div class="bg-white w-full max-w-2xl rounded-2xl p-6 soft-card relative">
      <button id="modal-close" class="absolute right-4 top-4 text-slate-500">âœ•</button>
      <h4 id="modal-title" class="text-xl font-bold"></h4>
      <div id="modal-meta" class="text-xs text-slate-500 mt-1"></div>
      <div id="modal-body" class="mt-4 text-slate-700"></div>
    </div>
  </div>

  <script>
    // Demo articles data (could later be fetched from DB)
    // const ARTICLES = [
    //   { id: 'a1', title: 'Panduan Singkat: Menurunkan 0.5 kg/minggu', category: 'diet', author: 'Dr. Sinta', date:'2025-06-01', excerpt: 'Target realistis untuk penurunan berat yang sehat...', body: '<p>Penurunan 0.25-0.5 kg/minggu dianggap aman. Kombinasikan defisit kalori moderat dengan olahraga...</p>' },
    //   { id: 'a2', title: '5 Gerakan Ringan di Rumah', category: 'exercise', author: 'Coach Rudi', date:'2025-01-12', excerpt: 'Gerakan sederhana untuk meningkatkan aktivitas harian...', body: '<p>Mulai dengan jalan di tempat, squat, dan plank. Lakukan 3x per minggu...</p>' },
    //   { id: 'a3', title: 'Mengapa Tidur Penting untuk Berat Badan', category: 'lifestyle', author: 'Dr. Maya', date:'2024-11-05', excerpt: 'Kualitas tidur mempengaruhi hormon nafsu makan...', body: '<p>Tidur kurang dari 7 jam dikaitkan dengan nafsu makan meningkat...</p>' }
    // ];

    // Categories derived from articles
    // const CATEGORIES = Array.from(new Set(ARTICLES.map(a=>a.category)));

    // UI elements
    const btnCalc = document.getElementById('btn-calc');
    const btnArticles = document.getElementById('btn-articles');
    const panelCalc = document.getElementById('panel-calc');
    const panelArticles = document.getElementById('panel-articles');
    const form = document.getElementById('bmi-form');
    const resultCard = document.getElementById('result-card');
    const avatarBox = document.getElementById('avatar-box');
    const sideAvatar = document.getElementById('side-avatar');
    const sideStatus = document.getElementById('side-status');
    const bmiValueEl = document.getElementById('bmi-value');
    const bmiCategoryEl = document.getElementById('bmi-category');
    const idealWeightEl = document.getElementById('ideal-weight');
    const timeEstimateEl = document.getElementById('time-estimate');
    const adviceArea = document.getElementById('advice-area');
    const articleList = document.getElementById('article-list');
    const articleCategory = document.getElementById('article-category');
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');
    const modalMeta = document.getElementById('modal-meta');
    const modalClose = document.getElementById('modal-close');
    const btnNewArticle = document.getElementById('btn-new-article');

    // init
    // function init(){
    //   // init categories
    //   CATEGORIES.forEach(cat => {
    //     const opt = document.createElement('option'); opt.value = cat; opt.textContent = cat; articleCategory.appendChild(opt);
    //   });
    //   renderArticles('all');
    //   panelArticles.scrollIntoView({ behavior: 'smooth' });
    // }

    // Toggle panels
    btnCalc.addEventListener('click', ()=>{ panelCalc.scrollIntoView({behavior:'smooth'}) });
    // btnArticles.addEventListener('click', ()=>{ panelArticles.scrollIntoView({behavior:'smooth'}) });

    // Render articles
    // function renderArticles(filter){
    //   articleList.innerHTML = '';
    //   const list = ARTICLES.filter(a => filter === 'all' ? true : a.category === filter);
    //   if(list.length === 0){ articleList.innerHTML = '<div class="text-sm text-slate-500">Tidak ada artikel di kategori ini.</div>'; return; }
    //   list.forEach(a => {
    //     const node = document.createElement('article');
    //     node.className = 'p-4 rounded-lg bg-white soft-card';
    //     node.innerHTML = `
    //       <div class="flex items-start gap-3">
    //         <div class="w-12 h-12 rounded-lg bg-gradient-to-tr from-emerald-300 to-emerald-500 text-white flex items-center justify-center font-bold">${a.category[0].toUpperCase()}</div>
    //         <div class="flex-1">
    //           <h4 class="font-semibold">${a.title}</h4>
    //           <div class="text-xs text-slate-500">${a.author} â€¢ ${a.date}</div>
    //           <p class="text-sm text-slate-600 mt-2">${a.excerpt}</p>
    //           <div class="mt-3 flex gap-2">
    //             <button data-id="${a.id}" class="btn-read px-3 py-1 rounded-lg bg-indigo-600 text-white text-sm">Baca</button>
    //             <button data-id="${a.id}" class="btn-cat px-3 py-1 rounded-lg border text-sm">Kategori: ${a.category}</button>
    //           </div>
    //         </div>
    //       </div>
    //     `;
    //     articleList.appendChild(node);
    //   });
    //   // attach listeners
    //   document.querySelectorAll('.btn-read').forEach(b => b.addEventListener('click', e => openArticle(e.target.dataset.id)));
    //   document.querySelectorAll('.btn-cat').forEach(b => b.addEventListener('click', e => { const id = e.target.dataset.id; const cat = ARTICLES.find(x=>x.id===id).category; articleCategory.value = cat; renderArticles(cat); }));
    // }

    // function openArticle(id){
    //   const a = ARTICLES.find(x=>x.id===id);
    //   if(!a) return;
    //   modalTitle.textContent = a.title;
    //   modalMeta.innerHTML = `${a.author} â€¢ ${a.date} â€¢ <span class='italic'>${a.category}</span>`;
    //   modalBody.innerHTML = a.body;
    //   modal.classList.remove('hidden'); modal.classList.add('flex');
    // }

    modalClose.addEventListener('click', ()=>{ modal.classList.add('hidden'); modal.classList.remove('flex'); });
    modal.addEventListener('click', (e)=>{ if(e.target === modal) { modal.classList.add('hidden'); modal.classList.remove('flex'); } });

    // Simple add demo article
    // btnNewArticle.addEventListener('click', ()=>{
    //   const newA = { id: 'a' + (ARTICLES.length+1), title: 'Tips Mini: Mulai Dari Kebiasaan Kecil', category: 'lifestyle', author:'Team', date: (new Date()).toISOString().slice(0,10), excerpt:'Ubah kebiasaan kecil untuk hasil besar...', body:'<p>Mulai dengan 10 menit jalan, tambah sayur di piring...</p>' };
    //   ARTICLES.unshift(newA); renderArticles(articleCategory.value || 'all');
    //   alert('Demo artikel ditambahkan.');
    // });

    // Article filter
    // articleCategory.addEventListener('change', ()=> renderArticles(articleCategory.value));

    // BMI calculation & ideal weight estimation
    function calculateBMI(weightKg, heightCm){
      const h = heightCm / 100.0;
      const bmi = weightKg / (h*h);
      return +bmi.toFixed(1);
    }

    function bmiCategory(bmi){
      if(bmi < 18.5) return 'Underweight';
      if(bmi < 25) return 'Normal (Sehat)';
      if(bmi < 30) return 'Overweight';
      return 'Obese';
    }

    // Simple ideal weight estimation: midpoint of BMI 18.5-24.9
    function estimateIdealWeight(heightCm){
      const h = heightCm/100;
      const low = 18.5 * h * h;
      const high = 24.9 * h * h;
      const mid = (low+high)/2;
      return +mid.toFixed(1);
    }

    // Time estimate: assume safe loss 0.25-0.5 kg/week if need to lose
    function estimateTime(currentWeight, idealWeight){
      const diff = Math.abs(currentWeight - idealWeight);
      if(diff < 0.5) return 0;
      const weeksMin = Math.ceil(diff / 0.5);
      return weeksMin; // minimal weeks to reach at healthy pace
    }

    function adviceForCategory(cat){
      switch(cat){
        case 'Underweight': return 'Pertimbangkan meningkatkan asupan kalori nutrisi-dense & latihan beban ringan. Konsultasi ahli gizi jika diperlukan.';
        case 'Normal (Sehat)': return 'Bagus! Pertahankan pola makan seimbang, aktivitas fisik rutin, dan tidur cukup.';
        case 'Overweight': return 'Mulai dengan defisit kalori moderat dan aktivitas fisik teratur (jalan, olahraga ringan). Hindari diet ekstrem.';
        case 'Obese': return 'Konsultasikan ke profesional kesehatan; fokus pada perubahan perilaku bertahap & aman.';
        default: return '';
      }
    }

    // Avatar mapping (simple emoji + color themes)
    const AVATARS = {
      'Underweight': { emoji:'ðŸ¥º', color:'from-sky-200 to-sky-400', title:'Underweight' },
      'Normal (Sehat)': { emoji:'ðŸ˜„', color:'from-emerald-300 to-emerald-500', title:'Sehat' },
      'Overweight': { emoji:'ðŸ˜…', color:'from-amber-300 to-amber-500', title:'Perlu Perbaikan' },
      'Obese': { emoji:'âš ï¸', color:'from-rose-300 to-rose-500', title:'Risiko Kesehatan' }
    };

    function showAvatarFor(category){
      const meta = AVATARS[category] || {emoji:'ðŸ™‚', color:'from-slate-200 to-slate-400', title:category};
      avatarBox.textContent = meta.emoji;
      avatarBox.style.background = '';
      avatarBox.className = 'avatar-box';
      // update side avatar
      sideAvatar.textContent = meta.emoji; sideAvatar.className = 'mx-auto avatar-box text-4xl font-bold';
      sideStatus.textContent = meta.title;
      // subtle pulse for attention
      avatarBox.classList.add('pulse'); setTimeout(()=> avatarBox.classList.remove('pulse'), 1600);
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const w = parseFloat(document.getElementById('weight').value);
      const h = parseFloat(document.getElementById('height').value);
      const age = parseInt(document.getElementById('age').value,10);
      const gender = document.getElementById('gender').value;
      if(!w || !h || !age){ alert('Isi semua field dengan nilai valid.'); return; }

      const bmi = calculateBMI(w,h);
      const category = bmiCategory(bmi);
      const ideal = estimateIdealWeight(h);
      const weeks = estimateTime(w, ideal);

      // Update UI
      bmiValueEl.textContent = bmi;
      bmiCategoryEl.textContent = category;
      idealWeightEl.textContent = ideal + ' kg';
      timeEstimateEl.textContent = weeks === 0 ? 'Sudah ideal' : weeks + ' minggu (minimum)';
      adviceArea.textContent = adviceForCategory(category);
      resultCard.classList.remove('hidden');

      // Avatar
      showAvatarFor(category);

      // Save last result locally (optional)
      const last = { dt: (new Date()).toISOString(), weight: w, height:h, age:age, gender:gender, bmi:bmi, category:category, ideal:ideal };
      try { localStorage.setItem('cmw_last', JSON.stringify(last)); }
      catch(e){}
    });

    // Reset
    document.getElementById('btn-reset').addEventListener('click', ()=>{
      form.reset(); resultCard.classList.add('hidden');
    });

    // Load last if exist
    window.addEventListener('load', ()=>{
    init();
    const last = localStorage.getItem('cmw_last');
    if(last){
      const obj = JSON.parse(last);
      document.getElementById('weight').value = obj.weight;
      document.getElementById('height').value = obj.height;
      document.getElementById('age').value = obj.age;
      document.getElementById('gender').value = obj.gender;
      // Tidak auto-submit lagi
      resultCard.classList.add('hidden');
    }
    });


    


  </script>
</body>
</html>
